!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function createModal(e,t,a,n){var r=document.createElement("div");r.className="modal fade",r.id=t,r.setAttribute("role","dialog"),r.setAttribute("aria-labelledby",t),r.setAttribute("aria-hidden","true"),document.body.appendChild(r);var o=document.createElement("div");o.className="modal-dialog "+n,o.setAttribute("role","document"),r.appendChild(o);var i=document.createElement("div");i.className="modal-content",o.appendChild(i);var l=document.createElement("div");l.className="modal-header",i.appendChild(l);var c=document.createElement("h5");c.className="modal-title",c.innerText=a,l.appendChild(c);var s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("data-dismiss","modal"),s.className="close",l.appendChild(s);var d=document.createElement("span");d.setAttribute("aria-hidden","true"),d.innerText="x",s.appendChild(d);var u=document.createElement("div");u.className="modal-body",u.id=t+"-content",i.appendChild(u);var p=document.createElement("div");p.className="modal-footer",p.id=t+"-footer",i.appendChild(p),$("#"+t).on("show.bs.modal",(function(){$("#"+e).css("opacity",.5)})),$("#"+t).on("hidden.bs.modal",(function(){$("#"+e).css("opacity",1),$("#"+t).remove()}))}function addButtons(id,Btns){Btns.forEach((function(Button){var Btn=document.createElement("button");Btn.setAttribute("type","button"),0!=Button.Func.length&&(Btn.onclick=function(){var call=Button.Func+"('"+Button.Action+"','');";eval(call)}),Btn.className="btn btn-"+Button.type,"log-out"==Button.Glyph&&Btn.setAttribute("data-dismiss","modal"),Btn.innerHTML="<span class='glyphicon glyphicon-"+Button.Glyph+"'></span> "+Button.Label,document.getElementById(id+"-footer").appendChild(Btn)}))}function alertBox(e,t,a,n){void 0===n&&(n=3e3),$("#ErrTitle").text(a),$("#ErrMsg").html(t),$("#ErrBox").removeClass("alert-success"),$("#ErrBox").removeClass("alert-danger"),$("#ErrBox").removeClass("alert-info"),$("#ErrBox").addClass("alert-"+e),$("#ErrBox").show(),setTimeout((function(){$("#ErrBox").fadeOut(1e3)}),n)}__webpack_require__.d(__webpack_exports__,"c",(function(){return createModal})),__webpack_require__.d(__webpack_exports__,"a",(function(){return addButtons})),__webpack_require__.d(__webpack_exports__,"b",(function(){return alertBox}))},function(e,t,a){"use strict";a.r(t);var n=a(0);function r(e,t){switch(e){case"init":o(0);break;case"edit":o(a=t);break;case"chooseProducer":i("Producteur","Choisir un producteur",!1);break;case"chooseReferent":i("Referent","Choisir un référent",!1);break;case"chooseSuppleant":i("Suppleant","Choisir un suppléant",!1);break;case"okProducteur":$("#producer").val($("#user-choose :selected").text());var a=$("#user-choose :selected").val();document.getElementById("producer").dataset.id=a,$("#choose-user").modal("hide");break;case"okReferent":$("#referent").val($("#user-choose :selected").text());a=$("#user-choose :selected").val();document.getElementById("referent").dataset.id=a,$("#choose-user").modal("hide");break;case"okSuppleant":$("#replace").val($("#user-choose :selected").text());a=$("#user-choose :selected").val();document.getElementById("replace").dataset.id=a,$("#choose-user").modal("hide");break;case"save":!function(e){null==e&&(e=!0);var t=!0;""==$("#contractName").val()?(t=!1,$("#contractName").addClass("required")):$("#contractName").removeClass("required");var a="";a+='{"id":"'+document.getElementById("contractName").dataset.id+'",',a+='"Name":"'+document.getElementById("contractName").value+'",',a+='"Type":"'+$("#contratType :selected").val()+'",';var n=document.getElementById("producer").dataset.id;"0"==n?(t=!1,$("#producer").addClass("required")):$("#producer").removeClass("required");a+='"idProducteur":"'+n+'",';var r=document.getElementById("referent").dataset.id;"0"==r?(t=!1,$("#referent").addClass("required")):$("#referent").removeClass("required");a+='"idReferent":"'+r+'",';var o=document.getElementById("replace").dataset.id;a+='"idSuppleant":"'+o+'",',a+='"curSeason":"'+$("#currentSeason").val()+'",',$("#locked").is(":checked")?a+='"locked":"true",':a+='"locked":"false",';if(a+='"Start":"'+$("#contract-start").val()+'",',a+='"End":"'+$("#contract-end").val()+'",',a+='"nbPeople":"'+$("#nbPeople").val()+'",',a+='"Document":"'+$("#contrat-doc").attr("href")+'",',a+='"price":"'+$("#amount").val()+'"}',t){var i={Action:"contrat",Want:"save",Vars:a};$.post("/ajax/index.php",i,(function(t){if(0!=t.Errno)return alert(t.ErrMsg),!1;e&&$("#contrat-edit").modal("hide")}))}else alert("Le contrat est invalide, veuillez le compléter")}(t);break;case"doc":!function(){n.c("contrat-edit","edit-doc","Contrat papier","modal-sm");n.a("edit-doc",[{Label:"Choisir",Func:"contrat",Action:"okDoc",Glyph:"ok",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]);var e=document.getElementById("edit-doc-content");(t=document.createElement("p")).innerHTML="Document actuel: "+$("#contrat-doc").text(),e.appendChild(t),(t=document.createElement("p")).innerHTML="Anciens contrats ",e.appendChild(t);var t,a=document.createElement("select");a.id="liste-doc",a.className="form-control",a.setAttribute("multiple",!0),a.style.height="100px",e.appendChild(a),(t=document.createElement("p")).innerHTML="<br /><span class='glyphicon glyphicon-download-alt'></span> Télécharger nouveau contrat",t.onclick=function(){contrat("uploadDoc","")},e.appendChild(t);var r=document.createElement("input");r.type="file",r.id="docFile",r.style.display="none",r.onchange=function(){contrat("loadDoc","")},e.appendChild(r),data={Action:"contrat",Want:"getDocs",Vars:$("#contractName").val()},$.post("/ajax/index.php",data,(function(e){document.getElementById("contractName").dataset.folder=e.Folder,e.Files.forEach((function(e){var t=document.createElement("option");t.text=e,a.add(t)}))})),$("#edit-doc").modal("show")}();break;case"uploadDoc":document.getElementById("docFile").click();break;case"loadDoc":r=$("#docFile").prop("files")[0],(p=new FormData).append("file",r),p.append("Action","contrat"),p.append("Want","uploadDoc"),p.append("Vars",$("#contractName").val()),$.ajax({url:"/ajax/index.php",data:p,cache:!1,contentType:!1,processData:!1,type:"post",success:function(e){data={Action:"contrat",Want:"getDocs",Vars:$("#contractName").val()},$("#liste-doc").empty();var t=document.getElementById("liste-doc");$.post("/ajax/index.php",data,(function(e){e.Files.forEach((function(e){var a=document.createElement("option");a.text=e,t.add(a)}))}))},failed:function(e){console.log(e)}});break;case"okDoc":!function(){var e=document.getElementById("contractName").dataset;$("#contrat-doc").text($("#liste-doc :selected").text()),$("#contrat-doc").attr("href",e.folder+"/"+$("#liste-doc :selected").text()),$("#edit-doc").modal("hide")}();break;case"livraison":!function(){n.c("contrat-edit","edit-livraison","Gestion des livraisons","");n.a("edit-livraison",[{Label:"Ajouter",Func:"contrat",Action:"addLivraison",Glyph:"plus",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]),$("#edit-livraison-content").css("minHeight","300px"),$("#edit-livraison-content").css("Height","300px");var e=document.createElement("table");e.className="table-condensed table-hover";var t=document.createElement("thead");e.appendChild(t);var a=t.insertRow();a.insertCell().innerHTML="Date",a.insertCell().innerHTML="Numéro",a.insertCell().innerHTML="Montant",a.insertCell().innerHTML="&nbsp;",$("#edit-livraison-content").append(e);var r=document.createElement("tbody");r.id="liste-livraison-body",e.appendChild(r),c(),$("#edit-livraison").modal("show")}();break;case"addLivraison":l(0);break;case"validLivraison":!function(e){var t=document.getElementById("contractName").dataset.id,a=$("#liste-livraison-date").val(),n=$("#liste-livraison-index").val(),r=$("#liste-livraison-montant").val(),o=parseFloat(r).toFixed(2),i='{"id":"'+e+'","idContrat":"'+t+'","frDate":"';i+=a+'","numLivraison":"'+n,i+='","Montant":"'+o+'"}',data={Action:"contrat",Want:"saveLivraison",Vars:i},$.post("/ajax/index.php",data,(function(e){0!=e.Errno&&alert(e.ErrMsg),c()}))}(t);break;case"editLivraison":l(t);break;case"delLivraison":!function(e){if(!confirm("Supprimer la livraison ?"))return!1;data={Action:"contrat",Want:"delLivraison",Vars:e},$.post("/ajax/index.php",data,(function(e){0!=e.Errno&&alert(e.ErrMsg),c()}))}(t);break;case"addWait":i("Wait","Ajouter à la liste d'attente",!1);break;case"okWait":!function(){var e=document.getElementById("contractName").dataset.id,t=$("#user-choose :selected").val();data={Action:"contrat",Want:"addWaitUser",Vars:'{"id":"'+t+'","idContrat":"'+e+'"}'},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return alert(e.ErrMsg),!1;s(),$("#choose-user").modal("hide")}))}();break;case"delWait":!function(e){var t=document.getElementById("contractName").dataset.id;data={Action:"contrat",Want:"delWaitUser",Vars:'{"id":"'+e+'","idContrat":"'+t+'"}'},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return alert(e.ErrMsg),!1;$("#choose-user").modal("hide"),s()}))}(t);break;case"acceptWait":alert("Pas implémenté - accepter liste");break;case"new":alert("Pas implémenté - nouvelle saison ");break;case"view":alert("Pas implémenté - détail utilisateur");break;case"valideContrat":alert("Pas implémenté - paiement reçu ?");break;case"addUser":i("User","Ajouter au contrat",!0);break;case"okUser":!function(){var e=document.getElementById("contractName").dataset.id,t=($("#user-choose :selected").val(),"[");$("#user-choose :selected").each((function(){t+='"'+$(this).val()+'",'})),t=t.slice(0,-1)+"]",console.log(t);var a='{"ids":'+t+',"idContrat":"'+e+'"}';console.log(a),data={Action:"contrat",Want:"addUser",Vars:a},$.post("/ajax/index.php",data,(function(t){if(0!=t.Errno)return alert(t.ErrMsg),!1;console.log(t.ErrMsg),d(e),$("#choose-user").modal("hide")}))}();break;case"editRules":!function(){n.c("contrat-edit","edit-rules","Règles de fonctionnement","");n.a("edit-rules",[{Label:"Accepter",Func:"contrat",Action:"okAttente",Glyph:"ok",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]),$("#edit-rules-content").css("Height","250px"),$("#edit-rules-content").css("minHeight","250px");var e=document.createElement("textarea");e.style.height="100%",e.style.width="100%",$("#edit-rules-content").append(e),$("#edit-rules").modal("show")}();break;case"editProduct":!function(e){n.c("contrat-edit","edit-product","Edition produit","");n.a("edit-product",[{Label:"Valider",Func:"contrat",Action:"okProduct",Glyph:"ok",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]),$("#edit-product-content").load("/tools/templates/product.smarty"),0!=e&&(data={Action:"contrat",Want:"loadProduct",Vars:e},$.post("/ajax/index.php",data,(function(t){if(0!=t.Errno)return alert(t.ErrMsg),!1;$("#label").val(t.Data[0].Label),document.getElementById("label").dataset.id=e,$("#unite").val(t.Data[0].Unite),$("#max").val(t.Data[0].MaxLivraison),$("#prix").val(t.Data[0].prix),$("#description").val(t.Data[0].Description)})));$("#edit-product").modal("show")}(t);break;case"okProduct":!function(){var e=document.getElementById("label"),t=e.dataset.id,a=e.value;if(""==a)return alert("Le label est obligatoire"),!1;var n=document.getElementById("unite").value,r=document.getElementById("max").value,o=document.getElementById("prix").value,i=document.getElementById("contractName").dataset.id,l=document.getElementById("description").value,c='{"id":"'+t+'","idContrat":"';c+=i+'","label":"'+a+'","unite":"',c+=n+'","max":"'+r+'","prix":"',c+=o+'","description":"'+l+'"}',data={Action:"contrat",Want:"saveProduct",Vars:c},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return alert(e.ErrMsg),!1;$("#edit-product").modal("hide"),u(i)}))}();break;case"delProduct":!function(e){console.log("Dans delProduct "+e),data={Action:"contrat",Want:"delProduct",Vars:e},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return alert(e.ErrMsg),!1;var t=document.getElementById("contractName").dataset.id;console.log("refresh "+t),u(t)}))}(t);break;default:console.log("Dans contrat - doAction: "+e)}var r,p}function o(e){n.c("id-contrat","contrat-edit","Gestion de contrat","modal-xl"),data={Action:"Content",Content:"ContratEdit"},$.post("/ajax/index.php",data,(function(t){$("#contrat-edit-content").html(t),document.getElementById("contractName").dataset.id=e}));0!=e&&(data={Action:"contrat",Want:"getInfo",Vars:e},$.post("/ajax/index.php",data,(function(t){console.log(t),$("#contractName").val(t.Data[0].Name),document.getElementById("contractName").dataset.id=t.Data[0].id,$('#contratType option[value="'+t.Data[0].idContratType+'"]').prop("selected",!0),$("#producer").val(t.Data[0].Producteur),document.getElementById("producer").dataset.id=t.Data[0].IdProducteur,$("#referent").val(t.Data[0].Referent),document.getElementById("referent").dataset.id=t.Data[0].IdReferent,$("#replace").val(t.Data[0].Suppleant),document.getElementById("replace").dataset.id=t.Data[0].IdSuppleant,$("#currentSeason").val(t.Data[0].EnCours),$("#h3-season").text(t.Data[0].EnCours),1==t.Data[0].Verouille?$("#locked").prop("checked",!0):$("#locked").prop("checked",!1);var a=t.Data[0].DebutContrat,n=a.substr(8,2)+"/"+a.substr(5,2)+"/"+a.substr(0,4);$("#contract-start").val(n);var r=t.Data[0].FinContrat,o=r.substr(8,2)+"/"+r.substr(5,2)+"/"+r.substr(0,4);$("#contract-end").val(o),$("#nbPeople").val(t.Data[0].nbPermanence),$("#amount").val(t.Data[0].PrixContrat);var i=t.Data[0].Document;$("#contrat-doc").text(i.replace(/.*\//,"")),$("#contrat-doc").attr("href",t.Data[0].Document),s(),d(e),u(e)}))),n.a("contrat-edit",[{Label:"Enregistrer",Func:"contrat",Action:"save",Glyph:"save",type:"primary"},{Label:"Nouvelle saison",Func:"contrat",Action:"new",Glyph:"repeat",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]),$("#contrat-edit").modal("show"),$("#contrat-edit").on("hidden.bs.modal",(function(){var e;(e=document.getElementById("liste-contrat")).innerHTML="",data={Action:"contrat",Want:"listeContrat",Vars:""},$.post("/ajax/index.php",data,(function(t){if(0!=t.Errno)return alert(t.ErrMsg),!1;t.Data.forEach((function(t){var a=e.insertRow();a.onclick=function(){contrat("edit",t.id)},a.insertCell().innerHTML=t.label,a.insertCell().innerHTML=t.Type,a.insertCell().innerHTML=t.Producteur,a.insertCell().innerHTML=t.Referent,a.insertCell().innerHTML=t.Verouille}))}))}))}function i(e,t,a){n.c("contrat-edit","choose-user",t,"modal-sm");var r=[{Label:"Choisir",Func:"contrat",Action:"ok"+e,Glyph:"ok",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}];n.a("choose-user",r);var o=document.createElement("select");o.id="user-choose",o.className="form-control",o.style.height="200px",o.style.minHeight="200px",o.multiple=a,document.getElementById("choose-user-content").appendChild(o);data={Action:"contrat",Want:"get"+e},$.post("/ajax/index.php",data,(function(e){e.forEach((function(e){var t=document.createElement("option");t.text=e.Raisoc,t.value=e.id,o.add(t)}))})),$("#choose-user").modal("show")}function l(e){var t=document.getElementById("liste-livraison-body");if(0==e){(o=t.insertRow()).id="liste-livraison-row-0";var a="",n=0,r="0"}else{a=(o=document.getElementById("liste-livraison-row-"+e)).cells[0].innerText,n=o.cells[1].innerText;var o,i=o.cells[2].innerText;r=i.substr(0,i.length-2);o.innerHTML=""}var l=o.insertCell();(c=document.createElement("input")).type="text",c.id="liste-livraison-date",c.style.width="100px",c.value=a,l.appendChild(c);var c;l=o.insertCell();(c=document.createElement("input")).type="text",c.id="liste-livraison-index",c.style.width="40px",c.value=n,l.appendChild(c),(l=o.insertCell()).style.textAlign="right",(c=document.createElement("input")).type="text",c.id="liste-livraison-montant",c.style.width="80px",c.value=r,l.appendChild(c),(l=o.insertCell()).innerHTML="<span class='glyphicon glyphicon-ok'></span>",l.style.textAlign="right",l.onclick=function(){contrat("validLivraison",e)},$("#liste-livraison-date").datepicker({altField:"#contract-end",closeText:"Fermer",prevText:"Précédent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Janv.","Févr.","Mars","Avril","Mai","Juin","Juil.","Août","Sept.","Oct.","Nov.","Déc."],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim.","Lun.","Mar.","Mer.","Jeu.","Ven.","Sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy"})}function c(){var e=document.getElementById("contractName").dataset.id,t=document.getElementById("liste-livraison-body");t.innerHTML="",data={Action:"contrat",Want:"listLivraison",Vars:e},$.post("/ajax/index.php",data,(function(e){0!=e.Errno&&alert(e.ErrMsg),console.log(e),e.Datas.forEach((function(e){var a=t.insertRow();a.id="liste-livraison-row-"+e.id,(n=a.insertCell()).innerHTML=e.frDate,(n=a.insertCell()).innerHTML=e.numLivraison,(n=a.insertCell()).style.textAlign="right",n.innerHTML=e.Montant+"<span> €</span>";var n=a.insertCell(),r="<span class='glyphicon glyphicon-trash' data-toggle='tooltip' title='Supprimer' ";r+="onClick=\"contrat('delLivraison',"+e.id+');"></span>',r+=" <span class='glyphicon glyphicon-pencil' data-toggle='tooltip' title='Modifier' ",r+="onClick=\"contrat('editLivraison',"+e.id+');"></span>',n.style.textAlign="right",n.innerHTML=r}))}))}function s(){console.log("Rafraichir la liste");var e=document.getElementById("contractName").dataset.id;data={Action:"contrat",Want:"listWait",Vars:e};var t=document.getElementById("waiting-list");t.innerHTML="",$.post("/ajax/index.php",data,(function(e){if(-1==e.Errno)return alert(e.ErrMsg),!1;e.Wait.forEach((function(e){var a,n=t.insertRow();(a=n.insertCell()).innerHTML=e.frDate,(a=n.insertCell()).innerHTML=e.Raisoc,(a=n.insertCell()).innerHTML=e.sTelMobile,(a=n.insertCell()).style.textAlign="right";var r="<span class='glyphicon glyphicon-thumbs-up pointer' ";r+=" data-toggle='tooltip' title='Accepter' ",r+='onclick=\'contrat("acceptWait",'+e.id+");'></span> ",r+="<span class='glyphicon glyphicon-trash pointer' ",r+=" data-toggle='tooltip' title='Retirer de la liste' ",r+='onclick=\'contrat("delWait",'+e.id+");'></span>",a.innerHTML=r}))}))}function d(e){if(null!=e)var t=e;else t=document.getElementById("contractName").dataset.id;data={Action:"contrat",Want:"refreshUserList",Vars:t},$.post("/ajax/index.php",data,(function(e){if(-1==e.Errno)return alert(e.ErrMsg),!1;var t=document.getElementById("user-list");t.innerHTML="",e.Data.forEach((function(e){var a,n=t.insertRow();(a=n.insertCell()).innerHTML=e.dateInscription,(a=n.insertCell()).innerHTML=e.Nom,(a=n.insertCell()).innerHTML=e.Prenom,(a=n.insertCell()).innerHTML=e.Telephone,(a=n.insertCell()).style.textAlign="right";var r="<input type='checkbox' data-toggle='tooltip'";r+=" title='Contrat en cours' ",r+="onchange=\"contrat('valideContrat',"+e.id+');">&nbsp;&nbsp;&nbsp;',r+="<span class='glyphicon glyphicon-search' data-toggle='tooltip' ",r+="title='Voir le détail' onclick=\"contrat('view',"+e.id+');"></span> ',r+="<span class='glyphicon glyphicon-trash' data-toggle='tooltip' ",r+="title='Supprimer' onclick=\"contrat('delUsr',"+e.id+');"></span>',a.innerHTML=r}))}))}function u(e){data={Action:"contrat",Want:"listProduct",Vars:e},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return alert(e.ErrMsg),!1;var t=document.getElementById("product-list");t.innerHTML="",e.Data.forEach((function(e){var a,n=t.insertRow();n.onclick=function(){contrat("editProduct",e.id)},(a=n.insertCell()).innerHTML=e.Label,(a=n.insertCell()).innerHTML=e.Unite,(a=n.insertCell()).innerHTML=e.Prix,(a=n.insertCell()).style.textAlign="right";var r="<span class='glyphicon glyphicon-trash' ";r+="data-toggle='tooltip' title='Supprimer' ",r+="onclick=\"contrat('delProduct',"+e.id+');"></span>',a.innerHTML=r})),console.log(e)}))}var p=["id","sEmail","sNom","sPrenom","sAdresse","sCodePostal","sVille","sTelephone","sTelMobile","sLogin","dateIns"];function m(e,t){if(null==e)return function(){n.c("content","user-manage","Gestion des utilisateurs","modal-xl"),$("#user-manage-content").addClass("myModal-body");n.a("user-manage",[{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]),h(),$("#user-manage").modal("show")}(),!1;switch(e){case"login":loadContent("Login");break;case"logout":$("#content").load("/templates/logout.smarty");break;case"quit":document.getElementById("cnx-info").dataset.connected="0",$.ajax({type:"GET",url:"ajax/logout.php",success:function(e){setTimeout((function(){window.location.href="/index.php"}),500)}});break;case"changePass":!function(){if("none"==document.getElementById("chg-pwd").style.display)return $("#btn-logout").hide(),$("#btn-change").text("Changer le mot de passe"),$("#chg-pwd").fadeIn(),!1;var e="<p>Votre mot de passe est incorrect.</p>";if(e+="<p>Il doit : ",e+="<ul><li>contenir au moins une minuscule</li>",e+="<li>contenir au moins une majuscule</li>",e+="<li>contenir au moins un chiffre</li>",e+="<li>contenir éventuellement un caractère spécial !@#$%^&*()_+-=[]{};:\\|,.<>/?</li>",e+="<li>avoir une taille minimale de 8 caractères</li></ul>",e+="</p><p>Les deux mots de passe doivent coincider</p>",e+="<p>Ex: <b>Pa$$w0Ord</b> - est un mot de passe compatible, mais, ne l'utilisez pas, il est mondialement connu !</p>",$("#pass1").val()!=$("#pass2").val())return e="<p>Vos mots de passe sont différents !</p>"+e,n.b("danger",e,"ERREUR",2e4),!1;var t=$("#pass1").val(),a=function(e){var t=0;if(!e)return t;for(var a=new Object,n=0;n<e.length;n++)a[e[n]]=(a[e[n]]||0)+1,t+=5/a[e[n]];var r={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)},o=0;for(var i in r)o+=1==r[i]?1:0;return t+=10*(o-1),parseInt(t)}(t);console.log("Votre score "+a),a>80&&(e="<p>Mot de passe fort</p>",n.b("info",e,"Information",2e3));if(a<30)return e="<p>Votre mot de passe n'est pas suffisement complexe</p>"+e,n.b("danger",e,"ERREUR",2e4),!1;data={Action:"User",Want:"changePass",Vars:t},$.post("/ajax/index.php",data,(function(e){0!=e.Errno?n.b("danger",e.ErrMsg,"ERREUR"):n.b("success",e.ErrMsg,"INFO")}))}();break;case"auth":!function(){var e=$("#login").val(),t=$("#password").val();if(""==e||""==t)return n.b("danger","Vous devez saisir un login et un mot de passe !","ERREUR"),!1;data={Action:"User",Want:"Login",Vars:'{"login":"'+e+'","passw":"'+t+'"}'},$.post("/ajax/index.php",data,(function(e){if(-1==e.Errno)return n.b("danger",e.ErrMsg,"ERREUR"),!1;console.log("Connexion OK");var t=document.getElementById("cnx-info");t.innerHTML="<span class='glyphicon glyphicon-user'></span> "+e.User.Prenom+" "+e.User.Nom,t.dataset.connected=1,t.onclick=function(){m("logout","")},loadContent("Main"),loadMenu()}))}();break;case"add":m("edit",0);break;case"save":!function(){var e=document.getElementById("sEmail").value;if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e))return $("sEmail").addClass("required"),alert("Le mail est incorrect !"),!1;if(""==e)return $("sEmail").addClass("required"),alert("Le mail est obligatoire !"),!1;if($("sEmail").removeClass("required"),""==document.getElementById("sNom").value)return $("sNom").addClass("required"),alert("Le Nom est obligatoire !"),!1;$("sNom").removeClass("required");var t='{"User":{';p.forEach((function(e){"dateIns"!=e&&(t+='"'+e+'":"'+$("#"+e).val()+'",')})),t=t.substring(0,t.length-1),t+='},"Rights":[';var a=!1;$("#checkRights input:checked").each((function(){t+='"'+$(this).val()+'",',a=!0})),a&&(t=t.substring(0,t.length-1));var n={Action:"User",Want:"save",Vars:t+="]}"};$.post("/ajax/index.php",n,(function(e){0!=e.Errno&&alert(e.ErrMsg),h(),$("#user-edit").modal("hide")}))}();break;case"del":!function(e){var t=document.getElementById("user-"+e),a="Effacer "+t.cells[0].innerText+" "+t.cells[1].innerText+" ?";confirm(a)&&(data={Action:"User",Want:"delUser",Vars:e});console.log(data),$.post("/ajax/index.php",data,(function(e){0!=e.Errno&&alert(e.ErrMsg),h()}))}(t);break;case"uniqueEmail":!function(e){if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e))return alert("Ce n'est pas un email valide !"),document.getElementById("sEmail").value="",$("#sEmail").focus(),!1;data={Action:"User",Want:"testEmail",Vars:e},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return confirm(e.ErrMsg)?v(e.id):($("#sEmail").val(""),$("#sEmail").focus()),!1;""==$("#sLogin").val()&&$("#sLogin").val($("#sEmail").val())}))}(t);break;case"edit":a=t,n.c("user-manage","user-edit","Edition utilisateur","modal-lg"),n.a("user-edit",[{Label:"Enregistrer",Func:"user",Action:"save",Glyph:"ok",type:"primary"},{Label:"Quitter",Func:"",Action:"",Glyph:"log-out",type:"secondary"}]),$("#user-edit-content").load("/tools/templates/userEdit.smarty",(function(){v(a),$("#user-edit").modal("show")}));break;case"pwd":!function(e){var t=document.getElementById("user-"+e),a="Nouveau mot de passe pour "+t.cells[0].innerText+" "+t.cells[1].innerText+" ?",n=prompt(a),r='{"id":"'+e+'","passwd":"'+n+'"}';n&&(data={Action:"User",Want:"changePassId",Vars:r},$.post("/ajax/index.php",data))}(t);break;case"Password":!function(){var e=$("#login").val();if(""==e)return alert("Vous devez donner votre email ou votre login !"),!1;data={Action:"User",Want:"resetPass",Vars:e},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return $("#ErrBox").removeClass("alert-info"),$("#ErrBox").addClass("alert-danger"),$("#ErrTitle").text("Erreur"),$("#ErrMsg").html(e.ErrMsg),!1;$("#ErrBox").removeClass("alert-danger"),$("#ErrBox").addClass("alert-info"),$("#ErrTitle").text("Information"),$("#ErrMsg").html("Votre nouveau mot de passe a été envoyé dans votre boîte aux lettres.")}))}();break;default:alert("Non implémenté "+e+" "+t)}var a}function h(){data={Action:"User",Want:"listUsers",Vars:""},$.post("/ajax/index.php",data,(function(e){$("#user-manage-content").html(e.html)}))}function v(e){if(0==e)return!0;data={Action:"User",Want:"loadUserId",Vars:e},$.post("/ajax/index.php",data,(function(e){if(0!=e.Errno)return alert(e.ErrMsg),!1;p.forEach((function(t){document.getElementById(t).value=e.User[t]})),e.Rights.forEach((function(e){var t=document.createElement("div"),a=document.createElement("input"),n=document.createElement("label");a.value=e.idRight,a.type="checkbox",a.name="rights",a.checked=e.gotRight,t.appendChild(a),n.setAttribute("for",e.idRight),n.innerText=e.sLabel,t.appendChild(n),document.getElementById("checkRights").appendChild(t)}))}))}function f(e,t){switch(e){case"backupAll":$("#backup-buttons").fadeOut("slow"),data={Action:"doBackup",Want:"makeIt",Type:"",id:""},n.b("info","Sauvegarde en cours","INFO",5e4),$.post("/ajax/index.php",data,(function(e){n.b("success","Sauvegarde terminée","SUCCESS",5e4),$("#sub-msg-2").html("Fichier de sauvegarde : <a href='"+e.File+"'>"+e.File+"</a>")}));break;case"restore":g(),$("#backup-buttons").fadeOut("slow"),$("#restore-options").fadeIn(),$("#loadBackup").change((function(){var e=$("#loadBackup").prop("files")[0],t=new FormData;if("application/zip"!=e.type)return alert("Ce n'est pas un fichier.zip"),!1;t.append("file",e),t.append("Action","loadFile"),t.append("Where","/_Backup/"),$.ajax({url:"/ajax/index.php",data:t,cache:!1,contentType:!1,processData:!1,type:"post",success:function(){g()}})}));break;case"restoreNow":!function(){if(0==$("#selectType").val())return alert("Veuillez choisir un type de restauration !"),!1;if(null==$("#selectBackup option:selected").val())return alert("Choisissez une sauvegarde à restaurer"),!1;$("#sub-msg-1").text("Restauration en cours ..."),data={Action:"doBackup",Want:"doRestore",Type:$("#selectType").val(),id:$("#selectBackup option:selected").val()},$.post("/ajax/index.php",data,(function(e){$("#sub-msg-1").text("Restauration terminée"),$("#sub-msg-2").html("Statut: "+e.ErrMsg)}))}();break;default:alert(e+" pas implémenté dans backup.js")}}function g(){data={Action:"doBackup",Want:"loadBackupList",Type:"",id:0},$.post("/ajax/index.php",data,(function(e){var t;e.forEach(e=>{t+="<option value="+e.id+">"+e.label+"</option>"}),$("#selectBackup").append(t)}))}window.contrat=function(e,t){r(e,t)},window.formatNumber=function(){!function(){var e=$("#amount").val();e.indexOf(",")>0&&(e=e.replace(",","."));var t=parseFloat(e).toFixed(2);e=$("#amount").val(t)}()},window.user=function(e,t){m(e,t)},window.getLink=function(){return prompt("Le lien")},window.backup=function(e,t){f(e)}}]);
//# sourceMappingURL=bundle.js.map