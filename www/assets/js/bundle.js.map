{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./www/src/app.js","webpack:///./www/src/modules/contrat.js","webpack:///./www/src/modules/helper.js","webpack:///./www/src/modules/modal.js"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AACiD;AACF;;AAE/C;AACA,GAAG,4DAAiB;AACpB;;AAEA;AACA,EAAE,+DAAoB;AACtB;;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAoC;AACpC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,MAAM;AACjB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,Y;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,Y;;AAEA;AACA;AACA,Y;AACA;AACA;;AAEA;AACA;AACA,WAAW,IAAI;AACf;AACA;AACA;AACA,EAAE,qDAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,EAAE,oDAAgB;AAClB;AACA;;AAEA;AACA;AACA,EAAE,qDAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE,oDAAgB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,KAAK;AACL,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,WAAW,KAAK;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,8D;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;;;AAGA;AACA;AACA;AACA,EAAE,qDAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE,oDAAgB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,6C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,GAAG,E;AACH;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,EAAE,qDAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE,oDAAgB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qD;AACA;AACA;AACA,6DAA6D,Y;AAC7D;AACA,8DAA8D,Y;AAC9D,qC;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAc,0CAA0C;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qE;AACA;AACA,yDAAyD;AACzD;;AAEA,KAAK;;;AAGL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,sDAAsD;AACtD;AACA;AACA;AACA,gEAAgE;;AAEhE;;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA,EAAE,qDAAiB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE,oDAAgB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7tBA;AAAA;AAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA,WAAW,EAAE;AACb,WAAW,EAAE;AACb;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD;AACzD,mB;AACA,Q;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,C","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./www/src/app.js\");\n","//import * as user from './modules/user.js';\nimport * as mContrat from './modules/contrat.js';\nimport * as helpers from './modules/helper.js';\n\nwindow.contrat = function(action, params){\n   mContrat.doAction(action, params);\n}\n\nwindow.formatNumber = function(){\n  helpers.formatNumber();\n}\n\n","import * as modal from './modal.js';\n/**\n * Gestion des contrats\n */\n\n/**\n * doAction \n * \n * Aiguillage des demandes liées au contrat\n * @param {string} action   Action demandée\n * @param {objet} params    Paramètres requis\n */\nexport function doAction(action, params)\n{\n  switch(action)\n  {\n    case 'init':\n      initFormContact(0);\n      break;\n\n    case 'edit':\n      // Retrouver id\n      var id=params;\n      initFormContact(id);\n      break;\n    \n    case 'chooseProducer':\n      chooseUser('Producteur',\"Choisir un producteur\");\n      break;\n\n    case 'chooseReferent':\n      chooseUser('Referent',\"Choisir un référent\");\n      break;\n      \n    case 'chooseSuppleant':\n      chooseUser('Suppleant',\"Choisir un suppléant\");\n      break;\n      \n    case 'okProducteur':\n      $('#producer').val($('#user-choose :selected').text());\n      var id = $('#user-choose :selected').val();\n      document.getElementById('producer').dataset.id=id;\n      $('#choose-user').modal('hide');\n      break;\n\n    case 'okReferent':\n      $('#referent').val($('#user-choose :selected').text());\n      var id = $('#user-choose :selected').val();\n      document.getElementById('referent').dataset.id=id;\n      $('#choose-user').modal('hide');\n      break;\n\n    case 'okSuppleant':\n      $('#replace').val($('#user-choose :selected').text());\n      var id = $('#user-choose :selected').val();\n      document.getElementById('replace').dataset.id=id;\n      $('#choose-user').modal('hide');\n      break;\n  \n    case 'save':\n      // Enregistrer le contrat (données)\n      saveContrat(params);\n      break;\n\n    case 'doc':\n      // Modifier le document contrat\n      editDoc();\n      break;\n  \n    case 'uploadDoc':\n      // Ouvrir le navigateur pour choisir un fichier\n      uploadDoc();\n      break;\n\n    case 'loadDoc':\n      // Charger le .pdf\n      loadDoc();\n      break;\n\n    case 'okDoc':\n      // On a choisi le contrat\n      okDoc();\n      break;\n\n    case 'livraison':\n      // gère les livraisons\n      livraison();\n      break; \n    \n    case 'addLivraison':\n      editLivraison(0);\n      break;\n\n    case 'validLivraison':\n      validLivraison(params);\n      break;\n\n    case 'editLivraison':\n      editLivraison(params);\n      break;\n  \n    case 'delLivraison':\n      delLivraison(params);\n      break;\n    \n    case 'addWait':\n      chooseUser('Wait', \"Ajouter à la liste d'attente\");\n      break;\n\n    case 'okWait':\n      okWait();\n      break;\n  \n      case 'editRules':\n      // Gestion des règles\n      editRules();\n      break; \n\n    default:\n      console.log(\"Dans contrat - doAction: \"+action);\n      break;  \n  }\n}\n\n/**\n * \n * @param {int} id    contrat à modifier, 0 si nouveau\n */\nfunction initFormContact(id)\n{\n  modal.createModal(\"id-contrat\", \"contrat-edit\", \"Gestion de contrat\",\"modal-xl\");\n  // Ajout du contenu contrat-edit-content\n  data ={\n    Action: \"Content\",\n    Content: \"ContratEdit\"\n  };\n  $.post(\"/ajax/index.php\", data, function (data) {\n    $('#contrat-edit-content').html(data);\n    document.getElementById('contractName').dataset.id = id;\n  });\n  var Btns=[{\n    Label:    \"Enregistrer\",\n    Func:     \"contrat\",\n    Action:   \"save\",\n    Glyph:    \"save\",\n    type:     \"primary\"\n  },{\n    Label:    \"Nouvelle saison\",\n    Func:     \"contrat\",\n    Action:   \"new\",\n    Glyph:    \"repeat\",\n    type:     \"primary\"\n  },{\n    Label:    \"Quitter\",\n    Func:     \"\",\n    Action:   \"\",\n    Glyph:    \"log-out\",\n    type:     \"secondary\"\n  }];\n  if( id != 0){\n    // get data\n    data={\n      Action: \"contrat\",\n      Want:   \"getInfo\",\n      Vars:   id\n    }\n    $.post(\"/ajax/index.php\", data, function (resp) {\n      console.log(resp);\n      $('#contractName').val(resp.Data[0].Name);\n      document.getElementById('contractName').dataset.id=resp.Data[0].id;\n      $('#contratType option[value=\"'+resp.Data[0].idContratType+'\"]').prop('selected', true);\n      $('#producer').val(resp.Data[0].Producteur);\n      document.getElementById('producer').dataset.id=resp.Data[0].IdProducteur;\n      $('#referent').val(resp.Data[0].Referent);\n      document.getElementById('referent').dataset.id=resp.Data[0].IdReferent;\n      $('#replace').val(resp.Data[0].Suppleant);\n      document.getElementById('replace').dataset.id=resp.Data[0].IdSuppleant;\n      $('#currentSeason').val(resp.Data[0].EnCours);\n      $(\"#h3-season\").text(resp.Data[0].EnCours);\n      if( resp.Data[0].Verouille == 1){\n        $('#locked').prop(\"checked\",true);\n      } else {\n        $('#locked').prop(\"checked\",false);\n      }\n      var Debut = resp.Data[0].DebutContrat;\n      var debContrat = Debut.substr(8,2)+\"/\"+Debut.substr(5,2);\n      $('#contract-start').val(debContrat);\n      var Fin = resp.Data[0].FinContrat;\n      var finContrat = Fin.substr(8,2)+\"/\"+Fin.substr(5,2);\n      $('#contract-end').val(finContrat);\n      $('#nbPeople').val(resp.Data[0].nbPermanence);\n      $('#amount').val(resp.Data[0].PrixContrat);\n      var contratDoc = resp.Data[0].Document;\n      $('#contrat-doc').text(contratDoc.replace(/.*\\//, ''));\n      $('#contrat-doc').attr(\"href\",resp.Data[0].Document);\n      refreshWaitingList();\n    });\n  }\n  modal.addButtons(\"contrat-edit\",Btns);\n  $('#contrat-edit').modal('show');\n}\n\nfunction chooseUser(type, title)\n{\n  modal.createModal(\"contrat-edit\", \"choose-user\", title,\"modal-sm\");\n  var Btns=[{\n    Label:    \"Choisir\",\n    Func:     \"contrat\",\n    Action:   \"ok\"+type,\n    Glyph:    \"ok\",\n    type:     \"primary\"\n  },{\n    Label:    \"Quitter\",\n    Func:     \"\",\n    Action:   \"\",\n    Glyph:    \"log-out\",\n    type:     \"secondary\"\n  }];\n  modal.addButtons(\"choose-user\",Btns);\n  var sel = document.createElement('select');\n  sel.id=\"user-choose\";\n  sel.className=\"form-control\";\n  sel.style.height=\"200px\";\n  sel.style.minHeight=\"200px\";\n  sel.multiple=true;\n  var div = document.getElementById('choose-user-content');\n  div.appendChild(sel);\n  var i =0;\n  data={\n    Action:  \"contrat\",\n    Want:    \"get\"+type\n  };\n  $.post(\"/ajax/index.php\", data, function (resp) {\n    resp.forEach(function(user){\n      var option = document.createElement('option');\n      option.text = user.Raisoc;\n      option.value = user.id;\n      sel.add(option);\n\n    });\n  });\n\n  $('#choose-user').modal('show');\n}\n\n/**\n * enregistre le contrat en cours d'édition\n * @param {bool} quit   si vrai, alors ferme le modal (valeur par défaut)\n */\nfunction saveContrat(quit)\n{\n\n  // TODO Toujours verrouillé - Bug\n  if( quit == undefined){\n    quit=true;\n  }\n  var formValid = true;\n  // Valider si on a bien les infos\n  if( $('#contractName').val() == \"\"){\n    formValid = false;\n    $('#contractName').addClass('required');\n  } else {\n    $('#contractName').removeClass('required');\n  }\n  var sPost='';\n  sPost += '{\"id\":\"'+document.getElementById(\"contractName\").dataset.id+'\",';\n  sPost += '\"Name\":\"'+document.getElementById(\"contractName\").value+'\",';\n  sPost += '\"Type\":\"'+$(\"#contratType :selected\").val()+'\",';\n  var idProducer = document.getElementById(\"producer\").dataset.id;\n  if( idProducer == '0'){\n    formValid = false;\n    $('#producer').addClass('required');\n  } else {\n    $('#producer').removeClass('required');\n  }\n  sPost += '\"idProducteur\":\"'+idProducer+'\",';\n  var idReferent = document.getElementById(\"referent\").dataset.id;\n  if( idReferent == '0'){\n    formValid = false;\n    $('#referent').addClass('required');\n  } else {\n    $('#referent').removeClass('required');\n  }\n  sPost += '\"idReferent\":\"'+idReferent+'\",';\n  var idSuppleant = document.getElementById(\"replace\").dataset.id;\n  \n  sPost += '\"idSuppleant\":\"'+idSuppleant+'\",';\n  sPost += '\"curSeason\":\"'+$(\"#currentSeason\").val()+'\",';\n  if($(\"#locked\").is(\":checked\")){\n    sPost += '\"locked\":\"true\",';\n  } else {\n    sPost += '\"locked\":\"false\",';\n  }\n  sPost += '\"Start\":\"'+$(\"#contract-start\").val() +'\",';\n  sPost += '\"End\":\"'+$(\"#contract-end\").val() +'\",';\n  sPost += '\"nbPeople\":\"'+$(\"#nbPeople\").val()+'\",';\n  sPost += '\"Document\":\"'+$('#contrat-doc').attr('href')+'\",'; \n  sPost += '\"price\":\"'+$(\"#amount\").val()+'\"}';\n  if( formValid ){\n    console.log(sPost);\n    var data={\n      Action: \"contrat\",\n      Want:   \"save\",\n      Vars:   sPost\n    }\n    $.post('/ajax/index.php',data,function(resp){\n      if(resp.Errno != 0){\n        alert(resp.ErrMsg);\n        return false;\n      }\n      if( quit ){\n        $('#contrat-edit').modal('hide');\n      }\n    });\n    // TODO refreshContrat()\n  } else {\n    alert('Le contrat est invalide, veuillez le compléter');\n  }\n}\n\n\nfunction editDoc()\n{\n  // TODO save si id == 0\n  modal.createModal(\"contrat-edit\", \"edit-doc\", \"Contrat papier\",\"modal-sm\");\n  var Btns=[{\n    Label:    \"Choisir\",\n    Func:     \"contrat\",\n    Action:   \"okDoc\",\n    Glyph:    \"ok\",\n    type:     \"primary\"\n  },{\n    Label:    \"Quitter\",\n    Func:     \"\",\n    Action:   \"\",\n    Glyph:    \"log-out\",\n    type:     \"secondary\"\n  }];\n  modal.addButtons(\"edit-doc\",Btns);\n  var doc = document.getElementById('edit-doc-content');\n  var p = document.createElement('p');\n  p.innerHTML = \"Document actuel: \"+$('#contrat-doc').text();\n  doc.appendChild(p);\n  var p = document.createElement('p');\n  p.innerHTML = \"Anciens contrats \";\n  doc.appendChild(p);\n  var select = document.createElement('select');\n  select.id = \"liste-doc\";\n  select.className = \"form-control\";\n  select.setAttribute(\"multiple\", true);\n  select.style.height=\"100px\";\n  doc.appendChild(select);\n  var p = document.createElement('p');\n  p.innerHTML=\"<br /><span class='glyphicon glyphicon-download-alt'></span> Télécharger nouveau contrat\";\n  p.onclick = function(){\n    contrat('uploadDoc',\"\");\n  };\n  doc.appendChild(p);\n  var input = document.createElement('input');\n  input.type=\"file\";\n  input.id='docFile';\n  input.style.display=\"none\";\n  input.onchange=function(){\n    contrat('loadDoc','');\n  }\n  doc.appendChild(input);\n  data={\n    Action:  \"contrat\",\n    Want:    \"getDocs\",\n    Vars:    $('#contractName').val()\n  };\n  $.post(\"/ajax/index.php\", data, function (resp) {\n    var contrat = document.getElementById(\"contractName\").dataset;\n    contrat.folder=resp.Folder;\n    resp.Files.forEach(function(File){\n      var option = document.createElement('option');\n      option.text = File;\n      select.add(option);\n    });\n  });\n  $('#edit-doc').modal('show');\n}\n\nfunction uploadDoc()\n{\n  // Déclencher le bouton input\n  document.getElementById('docFile').click(); \n}\n\nfunction loadDoc()\n{\n  // Charge le fichier \n  var file_data = $('#docFile').prop('files')[0];\n  var form_data = new FormData();\n  form_data.append('file', file_data);\n  form_data.append('Action', 'contrat');\n  form_data.append('Want',   'uploadDoc');\n  form_data.append('Vars',   $('#contractName').val());\n  // Demande à .php le chargement du fichier\n  $.ajax({\n    url: \"/ajax/index.php\",\n    data: form_data,\n    cache: false,\n    contentType: false,\n    processData: false,\n    type: 'post',\n    success: function (resp) {\n      // Rafraichir la liste\n      data={\n        Action:  \"contrat\",\n        Want:    \"getDocs\",\n        Vars:    $('#contractName').val()\n      };\n      $('#liste-doc').empty();\n      var select = document.getElementById('liste-doc');\n      $.post(\"/ajax/index.php\", data, function (resp) {\n        resp.Files.forEach(function(File){\n          var option = document.createElement('option');\n          option.text = File;\n          select.add(option);\n        });\n      });\n    },\n    failed: function(resp){\n      console.log(resp);\n    }\n  });    \n}\n\n\nfunction okDoc()\n{\n  var contrat = document.getElementById(\"contractName\").dataset;\n  $('#contrat-doc').text($('#liste-doc :selected').text());\n  $('#contrat-doc').attr('href',contrat.folder+\"/\"+$('#liste-doc :selected').text());\n  $('#edit-doc').modal('hide');\n}\n\n\nfunction livraison()\n{\n  // TODO save si id=0\n  modal.createModal(\"contrat-edit\", \"edit-livraison\", \"Gestion des livraisons\",\"\");\n  var Btns=[{\n    Label:    \"Ajouter\",\n    Func:     \"contrat\",\n    Action:   \"addLivraison\",\n    Glyph:    \"plus\",\n    type:     \"primary\"\n  },{\n    Label:    \"Quitter\",\n    Func:     \"\",\n    Action:   \"\",\n    Glyph:    \"log-out\",\n    type:     \"secondary\"\n  }];\n  modal.addButtons(\"edit-livraison\",Btns);\n  $('#edit-livraison-content').css(\"minHeight\",\"300px\");\n  $('#edit-livraison-content').css(\"Height\",\"300px\");\n  var table = document.createElement('table');\n  table.className=\"table-condensed table-hover\";\n  var thead = document.createElement('thead');\n  table.appendChild(thead);\n  var row = thead.insertRow();\n  var cell = row.insertCell();\n  cell.innerHTML = \"Date\";\n  var cell = row.insertCell();\n  cell.innerHTML = \"Numéro\";\n  var cell = row.insertCell();\n  cell.innerHTML = \"Montant\";\n  var cell = row.insertCell();\n  cell.innerHTML = \"&nbsp;\";\n  $('#edit-livraison-content').append(table);\n  var tbody = document.createElement('tbody');\n  tbody.id=\"liste-livraison-body\";\n  table.appendChild(tbody);\n  refreshLivraison();\n  $('#edit-livraison').modal('show');\n}\n\nfunction editLivraison(id)\n{\n  var el = document.getElementById('liste-livraison-body');\n  if( id == 0 ){\n    var row = el.insertRow();\n    row.id=\"liste-livraison-row-0\";\n    var rowDate='';\n    var rowNum=0;\n    var rowMontant=\"0\";\n  } else {\n    var row = document.getElementById(\"liste-livraison-row-\"+id);\n    var rowDate=row.cells[0].innerText;\n    var rowNum=row.cells[1].innerText;\n    var Montant = row.cells[2].innerText;\n    var rowMontant=Montant.substr(0,Montant.length-2);\n    row.innerHTML=\"\";\n  }\n  var cell = row.insertCell();\n  var inp = document.createElement('input');\n  inp.type=\"text\";\n  inp.id=\"liste-livraison-date\";\n  inp.style.width='100px';\n  inp.value=rowDate;\n  cell.appendChild(inp);\n  var cell = row.insertCell();\n  var inp = document.createElement('input');\n  inp.type=\"text\";\n  inp.id=\"liste-livraison-index\";\n  inp.style.width='40px';\n  inp.value=rowNum;\n  cell.appendChild(inp);\n  var cell = row.insertCell();\n  cell.style.textAlign=\"right\";\n  var inp = document.createElement('input');\n  inp.type=\"text\";\n  inp.id=\"liste-livraison-montant\";\n  inp.style.width='80px';\n  inp.value=rowMontant;\n  cell.appendChild(inp);\n  var cell = row.insertCell();\n  cell.innerHTML=\"<span class='glyphicon glyphicon-ok'></span>\";\n  cell.style.textAlign=\"right\";\n  cell.onclick= function(){\n    contrat('validLivraison',id);\n  };\n  $( \"#liste-livraison-date\" ).datepicker({\n    altField: \"#contract-end\",\n    closeText: 'Fermer',\n    prevText: 'Précédent',\n    nextText: 'Suivant',\n    currentText: 'Aujourd\\'hui',\n    monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],\n    monthNamesShort: ['Janv.', 'Févr.', 'Mars', 'Avril', 'Mai', 'Juin', 'Juil.', 'Août', 'Sept.', 'Oct.', 'Nov.', 'Déc.'],\n    dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],\n    dayNamesShort: ['Dim.', 'Lun.', 'Mar.', 'Mer.', 'Jeu.', 'Ven.', 'Sam.'],\n    dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],\n    weekHeader: 'Sem.',\n    dateFormat: 'dd/mm/yy'\n    });\n}\n\nfunction validLivraison(id)\n{\n  // TODO automatisation sys_livraison_produit / sys_permanence\n  var elContrat = document.getElementById('contractName');\n  var idContrat = elContrat.dataset.id;\n  // Lire les valeurs\n  var rowDate = $('#liste-livraison-date').val();\n  var rowIndex = $('#liste-livraison-index').val();\n  var sRowMontant = $('#liste-livraison-montant').val();\n  var rowMontant = parseFloat(sRowMontant).toFixed(2);\n  var sVars='{\"id\":\"'+id+'\",\"idContrat\":\"'+idContrat+'\",\"frDate\":\"';\n  sVars += rowDate+'\",\"numLivraison\":\"'+rowIndex;\n  sVars += '\",\"Montant\":\"'+rowMontant+'\"}';\n  data = {\n    Action: \"contrat\",\n    Want:   \"saveLivraison\",\n    Vars:   sVars\n  };\n  $.post('/ajax/index.php',data,function(resp){\n    if( resp.Errno != 0 ){\n      alert(resp.ErrMsg);\n    }\n    refreshLivraison();\n  });\n}\n\nfunction delLivraison(id)\n{\n  if( !confirm(\"Supprimer la livraison ?\") ){\n    return false;\n  }\n  data = {\n    Action: \"contrat\",\n    Want:   \"delLivraison\",\n    Vars:   id\n  };\n  $.post('/ajax/index.php',data,function(resp){\n    if( resp.Errno != 0 ){\n      alert(resp.ErrMsg);\n    }\n    refreshLivraison();\n  });\n}\n\nfunction refreshLivraison()\n{\n  var elContrat = document.getElementById('contractName');\n  var idContrat = elContrat.dataset.id;\n  var tbody = document.getElementById('liste-livraison-body');\n  tbody.innerHTML=\"\";\n  data={\n    Action: \"contrat\",\n    Want:   \"listLivraison\",\n    Vars:   idContrat\n  };\n  $.post(\"/ajax/index.php\",data,function(resp){\n    if( resp.Errno != 0){\n      alert(resp.ErrMsg);\n    }\n    console.log(resp);\n    resp.Datas.forEach(function (sRow){\n      var row = tbody.insertRow();\n      row.id = \"liste-livraison-row-\"+sRow.id;\n      var cell = row.insertCell();\n      cell.innerHTML= sRow.frDate;\n      var cell = row.insertCell();\n      cell.innerHTML= sRow.numLivraison;\n      var cell = row.insertCell();\n      cell.style.textAlign=\"right\";\n      cell.innerHTML= sRow.Montant+\"<span> €</span>\";    \n      var cell = row.insertCell();\n      var Html  = \"<span class='glyphicon glyphicon-trash' data-toggle='tooltip' title='Supprimer' \";\n      Html += \"onClick=\\\"contrat('delLivraison',\"+sRow.id+\");\\\"></span>\";    \n      Html += \" <span class='glyphicon glyphicon-pencil' data-toggle='tooltip' title='Modifier' \";\n      Html += \"onClick=\\\"contrat('editLivraison',\"+sRow.id+\");\\\"></span>\"; \n      cell.style.textAlign = \"right\";   \n      cell.innerHTML = Html;\n    });\n  });\n}\n\nfunction okWait()\n{\n  var elContrat = document.getElementById('contractName');\n  var idContrat = elContrat.dataset.id;\n  var id = $('#user-choose :selected').val();\n  var sVars='{\"id\":\"'+id+'\",\"idContrat\":\"'+idContrat+'\"}';\n  data={\n    Action: 'contrat',\n    Want:   'addWaitUser',\n    Vars:   sVars\n  };\n  $.post(\"/ajax/index.php\",data, function(resp){\n    if( resp.Errno != 0 ){\n      alert(resp.ErrMsg);\n      return false;\n    }\n    refreshWaitingList();\n  });\n  \n}\n\nfunction refreshWaitingList()\n{\n  var elContrat = document.getElementById('contractName');\n  var idContrat = elContrat.dataset.id;\n  data={\n    Action: \"contrat\",\n    Want:   \"listWait\",\n    Vars:   idContrat\n  };\n  var tbody = document.getElementById(\"waiting-list\");\n  tbody.innerHTML=\"\";\n  $.post('/ajax/index.php',data,function(resp){\n    if( resp.Errno == -1 ){\n      alert(resp.ErrMsg);\n      return false;\n    }\n    resp.Wait.forEach(function(line){\n      var row = tbody.insertRow();\n      var cell = row.insertCell();\n      cell.innerHTML = line.frDate;\n      var cell = row.insertCell();\n      cell.innerHTML = line.Raisoc;\n      var cell = row.insertCell();\n      cell.innerHTML = line.sTelMobile;\n      var cell = row.insertCell();\n      cell.style.textAlign=\"right\";\n      var Html  = \"<span class='glyphicon glyphicon-trash pointer' \";  \n      Html += \" data-toggle='tooltip' title='Retirer de la liste' \";\n      Html += \"onclick='contrat(\\\"delWait\\\",\"+line.id+\");'></span>\";\n      cell.innerHTML = Html;\n  \n    });\n\n\n  });\n  // var tbody = document.getElementById(\"waiting-list\");\n  // var row = tbody.insertRow();\n  //                     <td>01/05/2020</td>\n  //                     <td>NOEL Serge</td>\n  //                     <td>06.07.51.68.21</td>\n  //                     <td style='text-align: right;'>\n  //                       <span class=\"glyphicon glyphicon-trash pointer\"  \n  //                             data-toggle=\"tooltip\" \n  //                             title=\"Retirer de la liste\"\n  //                             onclick=\"contrat('delWait','');\"></span>\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction editRules()\n{\n  modal.createModal(\"contrat-edit\", \"edit-rules\", \"Règles de fonctionnement\",\"\");\n  var Btns=[{\n    Label:    \"Accepter\",\n    Func:     \"contrat\",\n    Action:   \"okAttente\",\n    Glyph:    \"ok\",\n    type:     \"primary\"\n  },{\n    Label:    \"Quitter\",\n    Func:     \"\",\n    Action:   \"\",\n    Glyph:    \"log-out\",\n    type:     \"secondary\"\n  }];\n  modal.addButtons(\"edit-rules\",Btns);\n  $('#edit-rules-content').css(\"Height\",\"250px\");\n  $('#edit-rules-content').css(\"minHeight\",\"250px\");\n  var aera = document.createElement('textarea');\n  aera.style.height=\"100%\";\n  aera.style.width='100%';\n  $('#edit-rules-content').append(aera);\n  $('#edit-rules').modal('show');\n}\n\n","export function formatNumber()\n{\n  var sPrix = $('#amount').val();\n\n  if( sPrix.indexOf(',') > 0){\n    sPrix = sPrix.replace(',','.');\n  }\n  var dPrix = parseFloat(sPrix).toFixed(2);\n  sPrix = $('#amount').val(dPrix);\n}\n","/**\n * \n * @param {string}   parent \n * @param {string}   id \n * @param {string}   titre \n * @param {string}   size     classe pour la taille de la boite modale <modal-xl||>\n */\nexport function createModal(parent, id, titre, size) {\n  var Div = document.createElement('div');\n  Div.className = \"modal fade\";\n  Div.id = id;\n  Div.setAttribute(\"role\", \"dialog\");\n  Div.setAttribute(\"aria-labelledby\", id);\n  Div.setAttribute(\"aria-hidden\", \"true\");\n  document.body.appendChild(Div);\n  var Div2 = document.createElement('div');\n  Div2.className = \"modal-dialog \"+size;\n  Div2.setAttribute(\"role\", \"document\");\n  Div.appendChild(Div2);\n  var Div3 = document.createElement('div');\n  Div3.className = \"modal-content\";\n  Div2.appendChild(Div3);\n  var Div4 = document.createElement('div');\n  Div4.className = \"modal-header\";\n  Div3.appendChild(Div4);\n  var Header = document.createElement('h5');\n  Header.className = \"modal-title\";\n  Header.innerText = titre;\n  Div4.appendChild(Header);\n  var Btn = document.createElement('button');\n  Btn.setAttribute(\"type\", \"button\");\n  Btn.setAttribute(\"data-dismiss\", \"modal\");\n  Btn.className = \"close\";\n  Div4.appendChild(Btn);\n  var Span = document.createElement('span');\n  Span.setAttribute(\"aria-hidden\", \"true\");\n  Span.innerText = \"x\";\n  Btn.appendChild(Span);\n  var DivContent = document.createElement('div');\n  DivContent.className = \"modal-body\";\n  DivContent.id = id + '-content';\n  Div3.appendChild(DivContent);\n  var DivFoot = document.createElement('div');\n  DivFoot.className = \"modal-footer\";\n  DivFoot.id = id + \"-footer\";\n  Div3.appendChild(DivFoot);\n\n  $('#' + id).on('show.bs.modal', function () {\n    $('#' + parent).css('opacity', 0.5);\n  });\n  $('#' + id).on('hidden.bs.modal', function () {\n    $('#' + parent).css('opacity', 1);\n    $('#' + id).remove();\n  });\n\n  // $('#'+id).modal('show');\n}\n\n/**\n * \n * @param {*} id \n * @param {*} Btns \n */\nexport function addButtons(id, Btns)\n{\n  Btns.forEach(function(Button){\n    var Btn = document.createElement('button');\n    Btn.setAttribute(\"type\", \"button\");\n    if( Button.Func.length != 0){\n      Btn.onclick = function () {\n        var call = Button.Func+\"('\"+Button.Action+\"','');\";\n        eval(call);         \n      };  \n    }\n    Btn.className = \"btn btn-\"+Button.type;\n    if( Button.Glyph == \"log-out\"){\n      Btn.setAttribute(\"data-dismiss\", \"modal\");\n    }\n    Btn.innerHTML = \"<span class='glyphicon glyphicon-\"+Button.Glyph+\"'></span> \"+Button.Label;\n    document.getElementById(id+\"-footer\").appendChild(Btn);\n  });\n}"],"sourceRoot":""}